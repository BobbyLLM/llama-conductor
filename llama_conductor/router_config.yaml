# router_config.yaml
# version 1.0.5 - CORRECTED

# Where to send OpenAI-compatible chat completion requests.
# Typically your llama-swap / llama.cpp OpenAI-ish endpoint.
llama_swap_url: "http://127.0.0.1:8011/v1/chat/completions"

# Router bind port (when running `python router_fastapi.py`)
port: 9000

# Router diagnostics (privacy-safe defaults).
router:
  debug: false
  debug_log_user_text: false

# Model role mapping (router passes `role=`; call_model resolves to these model IDs).
roles:
  thinker: "Qwen-3-4B Hivemind"
  critic: "Phi-4-mini"
  vision: "qwen-3-4B_VISUAL"
  coder: "Qwen-3-4B Hivemind"
  second_op: "Nanbeige 3B"

# Vault is Qdrant-only; Mentats uses this kb label when searching Qdrant.
vault_kb_name: "vault"

# Filesystem KB folders.
# These are *not* Qdrant. They are folders containing raw docs + SUMM_*.md files.
kb_paths:
  c64: "C:/docs/c64"
  amiga: "C:/docs/amiga"
  dogs: "C:/docs/dogs"

# Optional RAG settings (rag.py is still using its own defaults in v1.0.3).
rag:
  qdrant_host: "localhost"
  qdrant_port: 6333
  collection: "moa_kb_docs"
  vector_name: "e5_small_v2"

# Vodka settings (overrides vodka_filter.py defaults)
vodka:
  storage_dir: "."  # empty = cwd, or set explicit path
  base_ttl_days: 3
  touch_extension_days: 5
  max_touches: 2
  debug: false
  debug_dir: "."
  n_last_messages: 12
  keep_first: false
  max_chars: 6000
  enable_summary: true
  summary_every_n_user_msgs: 4
  summary_max_words: 80
  summary_inject_max_units: 3
  summary_inject_max_chars: 500
  summary_memory_max_units: 96
  summary_segments_per_message: 8
  summary_require_session_id: true
  summary_include_assistant: false
  summary_store_pii: false
  summary_pii_redaction_token: "[REDACTED]"

# Serious-mode generation tuning
serious:
  max_tokens: 384

# Recall semantic layer (deterministic first, semantic formatter with fallback)
recall:
  semantic_layer_enabled: true
  semantic_role: "thinker"
  semantic_max_tokens: 260
  semantic_temperature: 0.1
  semantic_top_p: 0.9
  semantic_unknown_ratio_max: 0.28

# Vault chunking (for >>move to vault ingestion)
vault:
  chunk_words: 250        # Smaller chunks = better semantic matching for queries
  chunk_overlap_words: 50  # Overlap prevents losing context at chunk boundaries

# Mentats diagnostics (off by default; payload logging opt-in).
mentats:
  debug: false
  debug_payload: false

# Scratchpad sidecar (ephemeral session-grounding)
scratchpad:
  storage_dir: "."         # base dir for total_recall/session_kb
  max_entries: 12          # max captures retained per session file
  max_capture_chars: 12000 # per-capture hard clip
  top_k: 3                 # retrieval hits merged into facts block
  max_chars: 1200          # max chars contributed to facts block
  max_age_minutes: 60      # hard expiry; pruned on scratchpad access
  exhaustive_response_mode: "raw"  # raw|llm; raw bypasses LLM for "all facts/everything" intents
